---
title: "محاسبه و رسم همبستگی متغیرها"
description:  در این پست با کتابخانه corrr آشنا خواهیم شد که به ما قابلیت های مختلفی برای محاسبه و رسم همبستگی متغیرهای یک دیتافریم می دهد. 
author:
  - name: mcnakhes
    url: mcnakhaee.com
date: 07-28-2020
editor_options: 
  chunk_output_type: consoles
output:
  distill::distill_article:
    toc: true
    toc_depth: 2
    self_contained: true
categories: 
  - مصورسازی
  - ggplot2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### مقدمه

یکی از گام های مهم برای پیاده سازی یک مدل یادگیری ماشین مرحله انتخاب ویژگی (feature selection) است. در این مرحله ما معمولا به دنبال این هستیم که از میان همه ویژگی هایی که در دیتاست موجود هستند تنها مهمترین ویژگی ها (متغیرهایی) که به ما برای پیشبینی متغیر هدف ما کمک می کنند را انتخاب کنیم تا عملکرد مدل مان را بهبود ببخشیم. به علاوه اگر فقط مهمترین ویژگی ها را انتخاب کنیم این مساله به ما کمک می کند تا خروجی مدل مان را به راحتی تفسیر کنیم ( هر چه تعداد متغیرهایی که مدل بر اساس آن پیشبینی انجام می دهد کمتر باشد فهم و درک خروجی مدل برای ما ساده تر می شود). یکی از صلی ترین روش ها برای انتخاب ویژگی محاسبه همبستگی بین ویژگی ها و حذف ویژگی هایی است که با متغیر هدف وابستگی زیادی ندارند یا همبستگی بالایی با بقیه ویژگی ها دارند.

### نصب

کتابخانه corrr بر روی CRAN قرار دارد و برای همین با اجرای دستور زیر می توانیم این کتابخانه را نصب می کنیم.


```{r, eval=FALSE}
install.packages("corrr")
```

### استفاده از کتابخانه corrr

```{r include = TRUE,message=FALSE, warning=FALSE,echo=TRUE}
library(corrr)
library(tidyverse)
library(dadegan)
```

اصلی ترین تابع کتابخانه corrr تابع correlate است .این تابع یک شی از نوع دیتافریم یا tbl را می گیرد و همبستگی بین متغیرهای را محاسبه می‌کند و آن‌ها را به صورت یک دیتافریم به ما باز می گرداند. در این دیتافریم هر ستون متناظر با یک متغیر و هر سطر نیز متناظر با یک متغیر است. یک دیتافریم از همبستگی ها را به ما باز می گرداند.


```{r}
corr_df <- spotify %>%
  select(danceability:time_signature)  %>%
  correlate()
head(corr_df)
```


به صورت پیشفرض `correlate` همبستگی پیرسون را برای ما محاسبه می‌کند ولی می‌توانیم با آرگومان `method` می‌توانیم از میان سایر روش‌های محاسبه همبستگی مثل `kendall ` یا `kendall ` استفاده کنیم.

به صورت پیشفرض این تابع مقادیر گمشده را نادیده می گیرد و فقط جفت مقادیر غیرگمشده را برای محاسبه همبستگی به کاربه علاوه، به صورت پیشفرض این تابع مقادیر گمشده را نادیده می گیرد و فقط جفت مقادیر غیرگمشده را برای محاسبه همبستگی به کار می برد.

همین طور به صورت پیشفرض مقدار همبستگی یک متغیر با خودش برابر با NA در نظر گرفته می شود. البته می توانیم این رفتار را با پارامتر diagonal تغییر دهیم. 


همانطور که گفتم خروجی  تابع correlate  یک دیتافریم از کلاس tibble است. در این حالت می توانیم این خروجی را به وسیله پایپ لاین به عنوان ورودی به توابع دیگر کتابخانه های tidyverse بدهیم. به طول مثال، می توانیم فقط همبستگی هایی که بالاتر از 0.5 هستند را انتخاب کنیم.

```{r}
corr_df %>% 
  filter(energy >0.5) %>%
  select(danceability,loudness,valence) 
```


علاوه بر تابع `correlate` کتابخانه corrr چندین تابع مفید دیگر را هم در دسترس ما قرار می دهد.یکی از این توابع تابع `shave` است که نیمه بالا یا پائین دیتافریم همبستگی ها را که اساسا تکراری است حذف می کند و به ما نمایش می دهد. تابع `fashion` هم خروجی دیتافریم همبستگی را کمی برای ما زیبا و مرتب می کند. 

```{r}
corr_df %>%
  filter(energy > 0.5) %>%
  shave() %>%
  fashion() 
```

تابع focus کتابخانه corrr هم مثل تابع select عمل می کند با این تفاوت که نه تنها با ستون ها را انتخاب می کنیم بلکه می توانیم سطرها را هم انتخاب کنیم.

```{r}
corr_df %>% 
  focus(danceability,loudness,valence,mirror = TRUE) 
```

### رسم نمودارهای همبستگی

کتابخانه corrr دو تابع هم برای رسم نمودار همبستگی بین متغیرهای در اختیار ما قرار می دهد. تابع اول `rplot` است که همبستگی بین متغیرها را به صورت دو به دو برای ما رسم می کند.

```{r fig.width=10}
corr_df %>% 
  shave %>%
  rplot
```


تابع دیگر `network_plot` است که به نظرم ایده جالبی برای رسم رابطه همبستگی بین متغیرها دارد. این تابع مقدار همبستگی بین متغیرها را به صورت یک گراف (شبکه) برای ما رسم می کند که رنگ هر گراف متناظر با میزان همبستگی بین دو متغیر است.

```{r fig.width=9}
corr_df %>% 
  network_plot(min_cor = 0.5,
               curved = FALSE)
```


منبع: 

https://cran.r-project.org/web/packages/corrr/vignettes/using-corrr.html

